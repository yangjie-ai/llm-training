# ä»é›¶å¼€å§‹è®­ç»ƒ0.5Bè¯­è¨€æ¨¡å‹å®Œå…¨æŒ‡å—

åœ¨å¤§è¯­è¨€æ¨¡å‹è“¬å‹ƒå‘å±•çš„ä»Šå¤©ï¼Œå¾ˆå¤šå¼€å‘è€…éƒ½æƒ³ä¸€æ¢ç©¶ç«Ÿï¼šå¦‚ä½•è®­ç»ƒä¸€ä¸ªå±äºè‡ªå·±çš„è¯­è¨€æ¨¡å‹ï¼Ÿæœ¬æ–‡å°†ä»¥è®­ç»ƒä¸€ä¸ª0.5Bå‚æ•°é‡çš„å°å‹è¯­è¨€æ¨¡å‹ä¸ºä¾‹ï¼Œå¸¦ä½ å®æˆ˜æŒæ¡æ¨¡å‹è®­ç»ƒçš„å…¨è¿‡ç¨‹ã€‚

## ä¸€ã€é¡¹ç›®æ¦‚è¿°

æˆ‘ä»¬å°†åŸºäºQwen 2.5-0.5Bæ¨¡å‹æ¶æ„ï¼Œä½¿ç”¨ä¸­æ–‡ç»´åŸºç™¾ç§‘æ•°æ®é›†è¿›è¡Œè®­ç»ƒï¼Œæ‰“é€ ä¸€ä¸ªå…·å¤‡ä¸­æ–‡ç†è§£èƒ½åŠ›çš„å°å‹è¯­è¨€æ¨¡å‹ã€‚è¿™ä¸ªé¡¹ç›®ç‰¹åˆ«é€‚åˆï¼š

- æƒ³è¦å…¥é—¨å¤§æ¨¡å‹è®­ç»ƒçš„å¼€å‘è€…
- å—é™äºç®—åŠ›ï¼Œä½†ä»æƒ³å°è¯•æ¨¡å‹è®­ç»ƒçš„ç ”ç©¶è€…
- å¯¹æ¨¡å‹è®­ç»ƒæµç¨‹æ„Ÿå…´è¶£çš„AIå­¦ä¹ è€…

## äºŒã€ç¯å¢ƒå‡†å¤‡

### 2.1 ç¡¬ä»¶è¦æ±‚

è®­ç»ƒ0.5Bå‚æ•°é‡çš„æ¨¡å‹ï¼Œå»ºè®®é…ç½®ï¼š

- GPUï¼šè‡³å°‘16GBæ˜¾å­˜ï¼ˆé¡¹ç›®ä½¿ç”¨äº†BF16ç²¾åº¦ä¼˜åŒ–ï¼‰
- RAMï¼š16GBä»¥ä¸Š
- å­˜å‚¨ï¼š50GBä»¥ä¸Šå¯ç”¨ç©ºé—´

### 2.2 ä¾èµ–åº“

```python
import datasets
import transformers
import modelscope
import torch
```

## ä¸‰ã€é¡¹ç›®æ¶æ„è®¾è®¡

### 3.1 æ—¥å¿—ç³»ç»Ÿ

æˆ‘ä»¬è®¾è®¡äº†ä¸€ä¸ªå®Œå–„çš„æ—¥å¿—ç³»ç»Ÿï¼Œä¾¿äºè¿½è¸ªè®­ç»ƒè¿‡ç¨‹ï¼š

```python
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(levelname)s: %(message)s',
    datefmt='%Y-%m-%d %H:%M:%S',
    handlers=[
        logging.StreamHandler(sys.stdout),
        logging.FileHandler('training.log')
    ]
)
```

### 3.2 è®­ç»ƒå›è°ƒå™¨

ä¸ºäº†æ›´å¥½åœ°ç›‘æ§è®­ç»ƒè¿‡ç¨‹ï¼Œæˆ‘ä»¬å®ç°äº†è‡ªå®šä¹‰å›è°ƒå™¨ï¼š

```python
class VerboseTrainingCallback(TrainerCallback):
    def __init__(self):
        self.train_loss = []
  
    def on_train_begin(self, args, state, control, **kwargs):
        logging.info("ğŸš€ è®­ç»ƒå¼€å§‹")
```

è¿™ä¸ªå›è°ƒå™¨å¯ä»¥ï¼š

- è®°å½•æ¯ä¸ªè®­ç»ƒæ­¥éª¤çš„æŸå¤±
- æä¾›å®æ—¶è®­ç»ƒè¿›åº¦
- åœ¨å…³é”®èŠ‚ç‚¹ï¼ˆå¦‚epochå¼€å§‹/ç»“æŸï¼‰è¾“å‡ºä¿¡æ¯

## å››ã€æ ¸å¿ƒè®­ç»ƒæµç¨‹

### 4.1 æ•°æ®å‡†å¤‡

æˆ‘ä»¬ä½¿ç”¨ä¸­æ–‡ç»´åŸºç™¾ç§‘æ•°æ®é›†ï¼Œå¹¶è¿›è¡Œ90/10çš„è®­ç»ƒæµ‹è¯•é›†åˆ’åˆ†ï¼š

```python
raw_datasets = datasets.load_dataset(
    "json",
    data_files="./data/wikipedia-cn-20230720-filtered.json"
)
raw_datasets = raw_datasets["train"].train_test_split(test_size=0.1, seed=2222)
```

### 4.2 åˆ†è¯å¤„ç†

ä½¿ç”¨Qwençš„åˆ†è¯å™¨ï¼Œå¹¶è®¾ç½®ä¸Šä¸‹æ–‡é•¿åº¦ä¸º512ï¼š

```python
def tokenize(element):
    outputs = tokenizer(
        element["completion"],
        truncation=True,
        max_length=context_length,
        return_overflowing_tokens=True,
        return_length=True,
    )
```

### 4.3 æ¨¡å‹é…ç½®

æˆ‘ä»¬ä½¿ç”¨äº†ä»¥ä¸‹é…ç½®æ„å»º0.5Bæ¨¡å‹ï¼š

```python
config = transformers.AutoConfig.from_pretrained(
    "./Qwen2.5-0.5B",
    vocab_size=len(tokenizer),
    hidden_size=512,
    intermediate_size=2048,
    num_attention_heads=8,
    num_hidden_layers=12,
    n_ctx=context_length
)
```

å…³é”®å‚æ•°è§£æï¼š

- hidden_size=512ï¼šéšè—å±‚ç»´åº¦
- num_attention_heads=8ï¼šæ³¨æ„åŠ›å¤´æ•°
- num_hidden_layers=12ï¼štransformerå±‚æ•°

### 4.4 è®­ç»ƒç­–ç•¥

æˆ‘ä»¬é‡‡ç”¨äº†ä¸€ç³»åˆ—è®­ç»ƒä¼˜åŒ–ç­–ç•¥ï¼š

1. **æ··åˆç²¾åº¦è®­ç»ƒ**ï¼š

```python
bf16=True if torch.cuda.is_available() else False
```

2. **å­¦ä¹ ç‡è°ƒåº¦**ï¼š

```python
learning_rate=2e-5,
lr_scheduler_type="cosine",
warmup_steps=200
```

ä½¿ç”¨cosineå­¦ä¹ ç‡è°ƒåº¦å™¨ï¼Œé…åˆwarmupæ­¥æ•°ï¼Œç¡®ä¿ç¨³å®šè®­ç»ƒã€‚

3. **æ¢¯åº¦ç´¯ç§¯**ï¼š

```python
gradient_accumulation_steps=8,
per_device_train_batch_size=16
```

é€šè¿‡æ¢¯åº¦ç´¯ç§¯ï¼Œå®ç°äº†ç­‰æ•ˆäºè¾ƒå¤§batch sizeçš„è®­ç»ƒæ•ˆæœã€‚

4. **æƒé‡è¡°å‡**ï¼š

```python
weight_decay=0.1
```

é˜²æ­¢è¿‡æ‹Ÿåˆã€‚

## äº”ã€è®­ç»ƒè¿‡ç¨‹ç›‘æ§

### 5.1 GPUç›‘æ§

è®­ç»ƒå‰è‡ªåŠ¨æ£€æŸ¥GPUçŠ¶æ€ï¼š

```python
def check_cuda_availability():
    logging.info(f"CUDAæ˜¯å¦å¯ç”¨: {torch.cuda.is_available()}")
    if torch.cuda.is_available():
        logging.info(f"CUDAè®¾å¤‡åç§°: {torch.cuda.get_device_name(0)}")
```

### 5.2 è®­ç»ƒè¿›åº¦è¿½è¸ª

è®¾ç½®äº†åˆç†çš„æ£€æŸ¥ç‚¹é—´éš”ï¼š

```python
eval_steps=500,
logging_steps=50,
save_steps=500
```

## å…­ã€å¸¸è§é—®é¢˜è§£ç­”

1. **ä¸ºä»€ä¹ˆé€‰æ‹©512çš„ä¸Šä¸‹æ–‡é•¿åº¦ï¼Ÿ**
   
   - å¹³è¡¡è®­ç»ƒæ•ˆç‡å’Œå®ç”¨æ€§
   - é€‚åˆå¤§å¤šæ•°çŸ­æ–‡æœ¬ç”Ÿæˆåœºæ™¯
   - é™ä½æ˜¾å­˜å ç”¨
2. **ä¸ºä»€ä¹ˆä½¿ç”¨8ä¸ªæ³¨æ„åŠ›å¤´ï¼Ÿ**
   
   - ç¬¦åˆæ¨¡å‹è§„æ¨¡
   - ä¿æŒè®¡ç®—æ•ˆç‡
   - è¶³å¤Ÿæ•æ‰å¤šç»´åº¦ç‰¹å¾
3. **å¦‚ä½•é€‰æ‹©å­¦ä¹ ç‡ï¼Ÿ**
   
   - 2e-5æ˜¯ç»éªŒå€¼
   - é…åˆwarmupå’Œcosineè°ƒåº¦
   - å¯æ ¹æ®è®­ç»ƒæƒ…å†µå¾®è°ƒ
4. **è®­ç»ƒæ—¶é—´å¤šé•¿ï¼Ÿ**
   
   - ä½¿ç”¨äº†A100-40Gï¼Œç”¨äº†2ä¸ªå°æ—¶

## ç»“è¯­

è®­ç»ƒä¸€ä¸ª0.5Bçš„è¯­è¨€æ¨¡å‹æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„å­¦ä¹ æœºä¼šï¼Œå®ƒèƒ½å¸®åŠ©ä½ ï¼š

- æ·±å…¥ç†è§£æ¨¡å‹è®­ç»ƒæµç¨‹
- æŒæ¡æ€§èƒ½ä¼˜åŒ–æŠ€å·§
- ç§¯ç´¯å®æˆ˜ç»éªŒ

è®°ä½ï¼Œæ¨¡å‹è®­ç»ƒæ˜¯ä¸€ä¸ªéœ€è¦åå¤è°ƒè¯•å’Œä¼˜åŒ–çš„è¿‡ç¨‹ã€‚å¸Œæœ›æœ¬æ•™ç¨‹èƒ½å¤Ÿå¸®åŠ©ä½ å¼€å¯è‡ªå·±çš„æ¨¡å‹è®­ç»ƒä¹‹æ—…ï¼

